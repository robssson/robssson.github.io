<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 - Statystyki</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { padding: 20px; background-color: #f9f9f9; }
    h1, h2 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
    h5 { text-align: center; margin-bottom: 10px; color: #555; }
    table th, table td { text-align: center; cursor: pointer; }
    .table-container { overflow-x: auto; margin-bottom: 50px; }
    .summary { text-align: center; font-weight: bold; margin-bottom: 10px; color: #34495e; }

    /* Kolory top3 */
    .first-place { background-color: #ffd700 !important; color: #000 !important; }
    .second-place { background-color: #c0c0c0 !important; color: #000 !important; }
    .third-place { background-color: #cd7f32 !important; color: #fff !important; }

    /* Efekt hover dla top3 */
    tr.first-place:hover { background-color: #ffea70 !important; }
    tr.second-place:hover { background-color: #e0e0e0 !important; }
    tr.third-place:hover { background-color: #d89454 !important; }

    /* Efekt hover dla pozosta≈Çych */
    table.table-hover tbody tr:hover:not(.first-place):not(.second-place):not(.third-place) {
        background-color: #f0f0f0 !important;
    }

    /* Ikony sortowania */
    th.sortable::after {
        content: '‚áÖ';
        font-size: 0.8em;
        margin-left: 5px;
        color: #999;
    }
    th.sorted-asc::after {
        content: '‚¨ÜÔ∏è';
        font-size: 0.8em;
        margin-left: 5px;
        color: #007bff;
    }
    th.sorted-desc::after {
        content: '‚¨áÔ∏è';
        font-size: 0.8em;
        margin-left: 5px;
        color: #007bff;
    }
</style>
</head>
<body>
<div class="container">
    <h5>Ostatnia aktualizacja: 15/10/2025</h5>
    <h1>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 üéØ</h1>

    <h2>Zestawienie wysokich zako≈Ñcze≈Ñ</h2>
    <p id="high-finishes-matches" class="summary"></p>
    <p id="high-finishes-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="high-finishes-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba wysokich zako≈Ñcze≈Ñ</th>
                    <th data-key="values" class="sortable">Warto≈õci zako≈Ñcze≈Ñ (>=100)</th>
                </tr>
            </thead>
            <tbody id="high-finishes-body"></tbody>
        </table>
    </div>

    <h2>Podsumowanie szybkich lotek</h2>
    <p id="fast-legs-matches" class="summary"></p>
    <p id="fast-legs-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="fast-legs-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba szybkich lotek</th>
                    <th data-key="values" class="sortable">Szybkie legi (<=18)</th>
                </tr>
            </thead>
            <tbody id="fast-legs-body"></tbody>
        </table>
    </div>
</div>

<script>
// --- Uniwersalna funkcja do sortowania tabel po klikniƒôciu ---
function makeSortable(tableId, rowsData, buildRow) {
    const table = document.getElementById(tableId);
    const headers = table.querySelectorAll('th.sortable');
    headers.forEach((th) => {
        let asc = true;
        th.addEventListener('click', () => {
            headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
            const key = th.dataset.key;
            rowsData.sort((a,b) => {
                let valA = a[key], valB = b[key];
                if(key === 'count') { valA = parseInt(valA); valB = parseInt(valB); }
                if(valA < valB) return asc ? -1 : 1;
                if(valA > valB) return asc ? 1 : -1;
                return 0;
            });
            th.classList.add(asc ? 'sorted-asc' : 'sorted-desc');
            asc = !asc;
            buildRow();
        });
    });
}

// --- WYSOKIE ZAKO≈ÉCZENIA ---
fetch('tournament_high_finishes.json').then(r => r.json()).then(data => {
    const playerFinishes = {};
    let totalHighFinishes = 0;
    const uniqueMatches = new Set(data.map(m => m.tmid));
    document.getElementById('high-finishes-matches').textContent = `Liczba rozegranych mecz√≥w: ${uniqueMatches.size}`;

    data.forEach(match => {
        const hf = match.high_finishes || {};
        for(const [player, finishes] of Object.entries(hf)) {
            if(!finishes || finishes.length===0) continue;
            if(!playerFinishes[player]) playerFinishes[player] = [];
            playerFinishes[player] = playerFinishes[player].concat(finishes);
            totalHighFinishes += finishes.length;
        }
    });
    document.getElementById('high-finishes-sum').textContent = `Suma wszystkich wysokich zako≈Ñcze≈Ñ: ${totalHighFinishes}`;

    const rowsData = Object.entries(playerFinishes).map(([player, finishes]) => ({
        player,
        count: finishes.length,
        values: finishes.sort((a,b)=>a-b).join(', ')
    })).sort((a,b) => b.count - a.count);

    const tbody = document.getElementById('high-finishes-body');
    function buildHighRows() {
        tbody.innerHTML = '';
        rowsData.forEach((row,index)=>{
            const tr = document.createElement('tr');
            if(index===0) tr.classList.add('first-place');
            else if(index===1) tr.classList.add('second-place');
            else if(index===2) tr.classList.add('third-place');
            tr.innerHTML = `<td>${row.player}</td><td>${row.count}</td><td>${row.values}</td>`;
            tbody.appendChild(tr);
        });
    }
    buildHighRows();
    makeSortable('high-finishes-table', rowsData, buildHighRows);
});

// --- SZYBKIE LOTKI ---
fetch('tournament_fast_legs.json').then(r => r.json()).then(data => {
    const fastTotal = {};
    const fastNumbers = {};
    let totalFastLegs = 0;
    const uniqueMatches = new Set(data.map(m => m.tmid));
    document.getElementById('fast-legs-matches').textContent = `Liczba rozegranych mecz√≥w: ${uniqueMatches.size}`;

    data.forEach(match=>{
        const fl = match.fast_legs || {};
        for(const [player, legs] of Object.entries(fl)){
            if(!legs || legs.length===0) continue;
            if(!fastTotal[player]) { fastTotal[player]=0; fastNumbers[player]=[]; }
            fastTotal[player]+=legs.length;
            fastNumbers[player]=fastNumbers[player].concat(legs);
            totalFastLegs+=legs.length;
        }
    });
    document.getElementById('fast-legs-sum').textContent = `Suma wszystkich szybkich lotek: ${totalFastLegs}`;

    const rowsData = Object.keys(fastTotal).map(player=>({
        player,
        count: fastTotal[player],
        values: fastNumbers[player].sort((a,b)=>a-b).join(', ')
    })).sort((a,b)=>b.count - a.count);

    const tbody = document.getElementById('fast-legs-body');
    function buildFastRows() {
        tbody.innerHTML = '';
        rowsData.forEach((row,index)=>{
            const tr = document.createElement('tr');
            if(index===0) tr.classList.add('first-place');
            else if(index===1) tr.classList.add('second-place');
            else if(index===2) tr.classList.add('third-place');
            tr.innerHTML = `<td>${row.player}</td><td>${row.count}</td><td>${row.values}</td>`;
            tbody.appendChild(tr);
        });
    }
    buildFastRows();
    makeSortable('fast-legs-table', rowsData, buildFastRows);
});
</script>
</body>
</html>
