<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 - Statystyki</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Sortable tables -->
    <script src="https://www.kryogenix.org/code/browser/sorttable/sorttable.js"></script>
    <style>
        body { padding: 20px; background-color: #f9f9f9; }
        h1, h2 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
        h5 { text-align: center; margin-bottom: 10px; color: #555; }
        table th, table td { text-align: center; }
        .table-container { overflow-x: auto; margin-bottom: 50px; }
        .summary { text-align: center; font-weight: bold; margin-bottom: 10px; color: #34495e; }

        /* Kolory dla miejsc 1-3 */
        .first-place { background-color: #ffd700 !important; color: #000 !important; }   /* z≈Çoty */
        .second-place { background-color: #c0c0c0 !important; color: #000 !important; }  /* srebrny */
        .third-place { background-color: #cd7f32 !important; color: #fff !important; }   /* brƒÖzowy */
    </style>
</head>
<body>
    <div class="container">
        <h5>Ostatnia aktualizacja: 15/10/2025</h5>
        <h1>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 üéØ</h1>

        <!-- WYSOKIE ZAKO≈ÉCZENIA -->
        <h2>Zestawienie wysokich zako≈Ñcze≈Ñ</h2>
        <p id="high-finishes-matches" class="summary">≈Åadowanie danych...</p>
        <p id="high-finishes-sum" class="summary"></p>
        <div class="table-container">
            <table class="table table-bordered table-hover sortable">
                <thead class="table-dark">
                    <tr>
                        <th>Zawodnik</th>
                        <th>Liczba wysokich zako≈Ñcze≈Ñ</th>
                        <th>Warto≈õci zako≈Ñcze≈Ñ (>=100)</th>
                    </tr>
                </thead>
                <tbody id="high-finishes-body"></tbody>
            </table>
        </div>

        <!-- SZYBKIE LOTKI -->
        <h2>Podsumowanie szybkich lotek</h2>
        <p id="fast-legs-matches" class="summary">≈Åadowanie danych...</p>
        <p id="fast-legs-sum" class="summary"></p>
        <div class="table-container">
            <table class="table table-bordered table-hover sortable">
                <thead class="table-dark">
                    <tr>
                        <th>Zawodnik</th>
                        <th>Liczba szybkich lotek</th>
                        <th>Szybkie legi (<=18)</th>
                    </tr>
                </thead>
                <tbody id="fast-legs-body"></tbody>
            </table>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // --- WYSOKIE ZAKO≈ÉCZENIA ---
        fetch('tournament_high_finishes.json')
            .then(resp => {
                if (!resp.ok) throw new Error('Nie uda≈Ço siƒô wczytaƒá tournament_high_finishes.json');
                return resp.json();
            })
            .then(data => {
                const playerFinishes = {};
                let totalHighFinishes = 0;

                // liczba unikalnych mecz√≥w po tmid
                const uniqueMatches = new Set(data.map(match => match.tmid));
                document.getElementById('high-finishes-matches').textContent = `Liczba rozegranych mecz√≥w: ${uniqueMatches.size}`;

                data.forEach(match => {
                    const highFinishes = match.high_finishes || {};
                    for (const [player, finishes] of Object.entries(highFinishes)) {
                        if (!finishes || finishes.length === 0) continue;
                        if (!playerFinishes[player]) playerFinishes[player] = [];
                        playerFinishes[player] = playerFinishes[player].concat(finishes);
                        totalHighFinishes += finishes.length;
                    }
                });

                document.getElementById('high-finishes-sum').textContent = `Suma wszystkich wysokich zako≈Ñcze≈Ñ: ${totalHighFinishes}`;

                const sortedPlayers = Object.entries(playerFinishes)
                    .sort((a,b) => b[1].length - a[1].length || a[0].localeCompare(b[0]));

                const tbody = document.getElementById('high-finishes-body');
                tbody.innerHTML = '';
                sortedPlayers.forEach(([player, finishes], index) => {
                    finishes.sort((a,b) => a-b);
                    const row = document.createElement('tr');

                    // Kolory dla trzech najlepszych miejsc
                    if(index === 0) row.classList.add('first-place');
                    else if(index === 1) row.classList.add('second-place');
                    else if(index === 2) row.classList.add('third-place');

                    row.innerHTML = `
                        <td>${player}</td>
                        <td>${finishes.length}</td>
                        <td>${finishes.join(', ')}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(err => {
                console.error(err);
                document.getElementById('high-finishes-matches').textContent = '‚ùå B≈ÇƒÖd wczytywania danych wysokich zako≈Ñcze≈Ñ';
                document.getElementById('high-finishes-sum').textContent = '';
            });

        // --- SZYBKIE LOTKI ---
        fetch('tournament_fast_legs.json')
            .then(resp => {
                if (!resp.ok) throw new Error('Nie uda≈Ço siƒô wczytaƒá tournament_fast_legs.json');
                return resp.json();
            })
            .then(data => {
                const fastTotal = {};
                const fastNumbers = {};
                let totalFastLegs = 0;

                // liczba unikalnych mecz√≥w po tmid
                const uniqueMatches = new Set(data.map(match => match.tmid));
                document.getElementById('fast-legs-matches').textContent = `Liczba rozegranych mecz√≥w: ${uniqueMatches.size}`;

                data.forEach(match => {
                    const fastLegs = match.fast_legs || {};
                    for (const [player, legs] of Object.entries(fastLegs)) {
                        if (!legs || legs.length === 0) continue;
                        if (!fastTotal[player]) {
                            fastTotal[player] = 0;
                            fastNumbers[player] = [];
                        }
                        fastTotal[player] += legs.length;
                        fastNumbers[player] = fastNumbers[player].concat(legs);
                        totalFastLegs += legs.length;
                    }
                });

                document.getElementById('fast-legs-sum').textContent = `Suma wszystkich szybkich lotek: ${totalFastLegs}`;

                const sortedPlayers = Object.keys(fastTotal)
                    .sort((a,b) => fastTotal[b] - fastTotal[a]);

                const tbody = document.getElementById('fast-legs-body');
                tbody.innerHTML = '';
                sortedPlayers.forEach((player, index) => {
                    const legs = fastNumbers[player].sort((a,b)=>a-b);
                    const row = document.createElement('tr');

                    // Kolory dla trzech najlepszych miejsc
                    if(index === 0) row.classList.add('first-place');
                    else if(index === 1) row.classList.add('second-place');
                    else if(index === 2) row.classList.add('third-place');

                    row.innerHTML = `
                        <td>${player}</td>
                        <td>${fastTotal[player]}</td>
                        <td>${legs.join(', ')}</td>
                    `;
                    tbody.appendChild(row);
                });
            })
            .catch(err => {
                console.error(err);
                document.getElementById('fast-legs-matches').textContent = '‚ùå B≈ÇƒÖd wczytywania danych szybkich lotek';
                document.getElementById('fast-legs-sum').textContent = '';
            });
    </script>
</body>
</html>
