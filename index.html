<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 - Statystyki</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { padding: 20px; background-color: #f9f9f9; }
    h1, h2 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
    h5 { text-align: center; margin-bottom: 10px; color: #555; }
    .summary { text-align: center; font-weight: bold; margin-bottom: 10px; color: #34495e; }
    table th, table td { text-align: center; cursor: pointer; }
    .table-container { overflow-x: auto; margin-bottom: 50px; }

    /* Kolory top3 */
    tr.first-place > td { background-color: #ffd700 !important; color: #000 !important; }
    tr.second-place > td { background-color: #c0c0c0 !important; color: #000 !important; }
    tr.third-place > td { background-color: #cd7f32 !important; color: #fff !important; }

    tr.first-place:hover > td { background-color: #ffea70 !important; }
    tr.second-place:hover > td { background-color: #e0e0e0 !important; }
    tr.third-place:hover > td { background-color: #d89454 !important; }

    table.table-hover tbody tr:hover:not(.first-place):not(.second-place):not(.third-place) td {
        background-color: #f0f0f0 !important;
    }

    th.sortable::after {
        content: '‚áÖ';
        font-size: 0.8em;
        margin-left: 5px;
        color: #999;
    }
    th.sorted-asc::after { content: '‚¨ÜÔ∏è'; color: #007bff; }
    th.sorted-desc::after { content: '‚¨áÔ∏è'; color: #007bff; }
</style>
</head>
<body>
<div class="container">
    <h5>Ostatnia aktualizacja: 15/10/2025</h5>
    <h1>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 üéØ</h1>

    <!-- WYBRYKI (zbiorcza tabela) -->
    <h2>üí™ Podsumowanie wybryk√≥w</h2>
    <p id="all-matches-summary" class="summary"></p>
    <p id="all-tricks-summary" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="tricks-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="matches" class="sortable">Rozegrane mecze</th>
                    <th data-key="total" class="sortable">Suma wybryk√≥w</th>
                    <th data-key="max" class="sortable">Maks√≥w (180)</th>
                    <th data-key="score170" class="sortable">Rzuty 170+</th>
                    <th data-key="high" class="sortable">Wysokie zako≈Ñczenia</th>
                    <th data-key="fast" class="sortable">Szybkie lotki</th>
                </tr>
            </thead>
            <tbody id="tricks-body"></tbody>
        </table>
    </div>

    <!-- MAKSY -->
    <h2>Podsumowanie maks√≥w (180)</h2>
    <p id="max-matches" class="summary"></p>
    <p id="max-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="max-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba 180</th>
                </tr>
            </thead>
            <tbody id="max-body"></tbody>
        </table>
    </div>

    <!-- WYSOKIE ZAKO≈ÉCZENIA -->
    <h2>Zestawienie wysokich zako≈Ñcze≈Ñ</h2>
    <p id="high-finishes-matches" class="summary"></p>
    <p id="high-finishes-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="high-finishes-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba wysokich zako≈Ñcze≈Ñ</th>
                    <th data-key="values">Warto≈õci (>=100)</th>
                </tr>
            </thead>
            <tbody id="high-finishes-body"></tbody>
        </table>
    </div>

    <!-- SZYBKIE LOTKI -->
    <h2>Podsumowanie szybkich lotek</h2>
    <p id="fast-legs-matches" class="summary"></p>
    <p id="fast-legs-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="fast-legs-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba szybkich lotek</th>
                    <th data-key="values">Legi (<=18)</th>
                </tr>
            </thead>
            <tbody id="fast-legs-body"></tbody>
        </table>
    </div>

    <!-- RZUTY 170‚Äì179 -->
    <h2>üî• Podsumowanie rzut√≥w 170+</h2>
    <p id="high-scores-matches" class="summary"></p>
    <p id="high-scores-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="high-scores-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba rzut√≥w 170+</th>
                    <th data-key="values">Wyniki</th>
                </tr>
            </thead>
            <tbody id="high-scores-body"></tbody>
        </table>
    </div>
</div>

<script>
function makeSortable(tableId, rowsData, buildRow) {
    const headers = document.querySelectorAll(`#${tableId} th.sortable`);
    headers.forEach(th => {
        let asc = false;
        th.addEventListener('click', () => {
            headers.forEach(h => h.classList.remove('sorted-asc','sorted-desc'));
            const key = th.dataset.key;
            rowsData.sort((a,b)=>{
                let va=a[key], vb=b[key];
                if(!isNaN(va) && !isNaN(vb)) return asc ? va - vb : vb - va;
                if(typeof va==='string') va=va.toLowerCase();
                if(typeof vb==='string') vb=vb.toLowerCase();
                if(va<vb) return asc?-1:1;
                if(va>vb) return asc?1:-1;
                return 0;
            });
            th.classList.add(asc?'sorted-asc':'sorted-desc');
            asc=!asc;
            buildRow();
        });
    });
}

function colorizeTop3(tbody, rows, buildFn) {
    tbody.innerHTML = '';
    rows.forEach((r,i)=>{
        const tr=document.createElement('tr');
        if(i===0) tr.classList.add('first-place');
        else if(i===1) tr.classList.add('second-place');
        else if(i===2) tr.classList.add('third-place');
        tr.innerHTML = buildFn(r);
        tbody.appendChild(tr);
    });
}

Promise.all([
    fetch('tournament_max.json').then(r=>r.json()),
    fetch('tournament_high_finishes.json').then(r=>r.json()),
    fetch('tournament_fast_legs.json').then(r=>r.json()),
    fetch('tournament_high_scores.json').then(r=>r.json())
]).then(([maxData, highData, fastData, highScoresData])=>{
    const maxStats={}, highStats={}, fastStats={}, highScoresStats={};
    const allMatches=new Map();
    const allMatchIDs=new Set();

    // MAXY
    let totalMax=0;
    const maxMatches=new Set();
    maxData.forEach(m=>{
        allMatchIDs.add(m.tmid);
        const maxes=m.maxes||{};
        for(const [p,list] of Object.entries(maxes)){
            if(!maxStats[p]) maxStats[p]=[];
            maxStats[p].push(...list);
            totalMax+=list.length;
            if(!allMatches.has(p)) allMatches.set(p,new Set());
            allMatches.get(p).add(m.tmid);
        }
        maxMatches.add(m.tmid);
    });
    document.getElementById('max-matches').textContent=`Liczba rozegranych mecz√≥w: ${maxMatches.size}`;
    document.getElementById('max-sum').textContent=`Suma wszystkich 180: ${totalMax}`;
    const maxRows=Object.entries(maxStats).filter(([_,vals])=>vals.length>0).map(([p,vals])=>({player:p,count:vals.length})).sort((a,b)=>b.count-a.count);
    const maxBody=document.getElementById('max-body');
    const buildMaxRow=r=>`<td>${r.player}</td><td>${r.count}</td>`;
    colorizeTop3(maxBody,maxRows,buildMaxRow);
    makeSortable('max-table',maxRows,()=>colorizeTop3(maxBody,maxRows,buildMaxRow));

    // HIGH FINISHES
    let totalHigh=0;
    const highMatches=new Set();
    highData.forEach(m=>{
        allMatchIDs.add(m.tmid);
        const hf=m.high_finishes||{};
        for(const [p,list] of Object.entries(hf)){
            if(!highStats[p]) highStats[p]=[];
            highStats[p].push(...list);
            totalHigh+=list.length;
            if(!allMatches.has(p)) allMatches.set(p,new Set());
            allMatches.get(p).add(m.tmid);
        }
        highMatches.add(m.tmid);
    });
    document.getElementById('high-finishes-matches').textContent=`Liczba rozegranych mecz√≥w: ${highMatches.size}`;
    document.getElementById('high-finishes-sum').textContent=`Suma wszystkich wysokich zako≈Ñcze≈Ñ: ${totalHigh}`;
    const highRows=Object.entries(highStats).filter(([_,vals])=>vals.length>0).map(([p,vals])=>({player:p,count:vals.length,values:vals.sort((a,b)=>a-b).join(', ')})).sort((a,b)=>b.count-a.count);
    const highBody=document.getElementById('high-finishes-body');
    const buildHighRow=r=>`<td>${r.player}</td><td>${r.count}</td><td>${r.values}</td>`;
    colorizeTop3(highBody,highRows,buildHighRow);
    makeSortable('high-finishes-table',highRows,()=>colorizeTop3(highBody,highRows,buildHighRow));

    // FAST LEGS
    let totalFast=0;
    const fastMatches=new Set();
    fastData.forEach(m=>{
        allMatchIDs.add(m.tmid);
        const fl=m.fast_legs||{};
        for(const [p,list] of Object.entries(fl)){
            if(!fastStats[p]) fastStats[p]=[];
            fastStats[p].push(...list);
            totalFast+=list.length;
            if(!allMatches.has(p)) allMatches.set(p,new Set());
            allMatches.get(p).add(m.tmid);
        }
        fastMatches.add(m.tmid);
    });
    document.getElementById('fast-legs-matches').textContent=`Liczba rozegranych mecz√≥w: ${fastMatches.size}`;
    document.getElementById('fast-legs-sum').textContent=`Suma wszystkich szybkich lotek: ${totalFast}`;
    const fastRows=Object.entries(fastStats).filter(([_,vals])=>vals.length>0).map(([p,vals])=>({player:p,count:vals.length,values:vals.sort((a,b)=>a-b).join(', ')})).sort((a,b)=>b.count-a.count);
    const fastBody=document.getElementById('fast-legs-body');
    const buildFastRow=r=>`<td>${r.player}</td><td>${r.count}</td><td>${r.values}</td>`;
    colorizeTop3(fastBody,fastRows,buildFastRow);
    makeSortable('fast-legs-table',fastRows,()=>colorizeTop3(fastBody,fastRows,buildFastRow));

    // HIGH SCORES 170‚Äì179
    let totalHighScores=0;
    const highScoreMatches=new Set();
    highScoresData.forEach(m=>{
        allMatchIDs.add(m.tmid);
        const scores=m.scores||{};
        for(const [p,list] of Object.entries(scores)){
            if(!highScoresStats[p]) highScoresStats[p]=[];
            const filtered=list.filter(v=>v>=170 && v<180);
            highScoresStats[p].push(...filtered);
            totalHighScores+=filtered.length;
            if(!allMatches.has(p)) allMatches.set(p,new Set());
            allMatches.get(p).add(m.tmid);
        }
        highScoreMatches.add(m.tmid);
    });
    document.getElementById('high-scores-matches').textContent=`Liczba rozegranych mecz√≥w: ${highScoreMatches.size}`;
    document.getElementById('high-scores-sum').textContent=`Suma wszystkich rzut√≥w 170‚Äì179: ${totalHighScores}`;
    const highScoreRows=Object.entries(highScoresStats).filter(([_,vals])=>vals.length>0).map(([p,vals])=>({player:p,count:vals.length,values:vals.sort((a,b)=>a-b).join(', ')})).sort((a,b)=>b.count-a.count);
    const highScoreBody=document.getElementById('high-scores-body');
    const buildHighScoreRow=r=>`<td>${r.player}</td><td>${r.count}</td><td>${r.values}</td>`;
    colorizeTop3(highScoreBody,highScoreRows,buildHighScoreRow);
    makeSortable('high-scores-table',highScoreRows,()=>colorizeTop3(highScoreBody,highScoreRows,buildHighScoreRow));

    // WYBRYKI (zbiorcza tabela)
    const allPlayers = new Set([...Object.keys(maxStats), ...Object.keys(highStats), ...Object.keys(fastStats), ...Object.keys(highScoresStats)]);
    const rows = [];
    allPlayers.forEach(p => {
        const max = maxStats[p]?.length || 0;
        const score170 = highScoresStats[p]?.length || 0;
        const high = highStats[p]?.length || 0;
        const fast = fastStats[p]?.length || 0;
        const total = max + score170 + high + fast;
        if (total > 0) {
            const matches = allMatches.get(p)?.size || 0;
            rows.push({ player: p, matches, total, max, score170, high, fast });
        }
    });
    rows.sort((a,b)=>b.total - a.total);
    const tbody=document.getElementById('tricks-body');
    const buildRow=r=>`<td>${r.player}</td><td>${r.matches}</td><td>${r.total}</td><td>${r.max}</td><td>${r.score170}</td><td>${r.high}</td><td>${r.fast}</td>`;
    colorizeTop3(tbody,rows,buildRow);
    makeSortable('tricks-table',rows,()=>colorizeTop3(tbody,rows,buildRow));

    document.getElementById('all-tricks-summary').textContent=`Suma wszystkich wybryk√≥w: ${rows.reduce((a,b)=>a+b.total,0)}`;
    document.getElementById('all-matches-summary').textContent=`Liczba rozegranych mecz√≥w (≈ÇƒÖcznie): ${allMatchIDs.size}`;
}).catch(err=>{
    console.error('B≈ÇƒÖd wczytywania danych:',err);
});
</script>
</body>
</html>
