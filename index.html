<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 - Statystyki</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { padding: 20px; background-color: #f9f9f9; }
    h1, h2 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
    h5 { text-align: center; margin-bottom: 10px; color: #555; }
    .summary, #global-summary { text-align: center; font-weight: bold; margin-bottom: 10px; color: #34495e; }
    table th, table td { text-align: center; cursor: pointer; }
    .table-container { overflow-x: auto; margin-bottom: 50px; }

    /* Kolory TOP3 */
    tr.first-place > td { background-color: #ffd700 !important; color: #000 !important; }
    tr.second-place > td { background-color: #c0c0c0 !important; color: #000 !important; }
    tr.third-place > td { background-color: #cd7f32 !important; color: #fff !important; }

    tr.first-place:hover > td { background-color: #ffea70 !important; }
    tr.second-place:hover > td { background-color: #e0e0e0 !important; }
    tr.third-place:hover > td { background-color: #d89454 !important; }

    table.table-hover tbody tr:hover:not(.first-place):not(.second-place):not(.third-place) td {
        background-color: #f0f0f0 !important;
    }

    th.sortable::after {
        content: '‚áÖ';
        font-size: 0.8em;
        margin-left: 5px;
        color: #999;
    }
    th.sorted-asc::after { content: '‚¨ÜÔ∏è'; color: #007bff; }
    th.sorted-desc::after { content: '‚¨áÔ∏è'; color: #007bff; }
</style>
</head>
<body>
<div class="container">
    <h5>Ostatnia aktualizacja: 15/10/2025</h5>
    <h1>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 üéØ</h1>

    <div id="global-summary" class="mb-4 fs-5">
        üîÑ ≈Åadowanie danych...
    </div>

    <!-- WYBRYKI -->
    <h2>üí™ Podsumowanie wybryk√≥w</h2>
    <p id="all-tricks-summary" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="tricks-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="matches" class="sortable">Rozegrane mecze</th>
                    <th data-key="total" class="sortable">Suma wybryk√≥w</th>
                    <th data-key="max" class="sortable">Maks√≥w (180)</th>
                    <th data-key="high" class="sortable">Wysokie zako≈Ñczenia</th>
                    <th data-key="fast" class="sortable">Szybkie lotki</th>
                </tr>
            </thead>
            <tbody id="tricks-body"></tbody>
        </table>
    </div>

    <!-- MAKSY -->
    <h2>Podsumowanie maks√≥w (180)</h2>
    <p id="max-matches" class="summary"></p>
    <p id="max-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="max-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba 180</th>
                    <th data-key="values">Szczeg√≥≈Çy</th>
                </tr>
            </thead>
            <tbody id="max-body"></tbody>
        </table>
    </div>

    <!-- WYSOKIE ZAKO≈ÉCZENIA -->
    <h2>Zestawienie wysokich zako≈Ñcze≈Ñ</h2>
    <p id="high-finishes-matches" class="summary"></p>
    <p id="high-finishes-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="high-finishes-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba wysokich zako≈Ñcze≈Ñ</th>
                    <th data-key="values">Warto≈õci zako≈Ñcze≈Ñ (>=100)</th>
                </tr>
            </thead>
            <tbody id="high-finishes-body"></tbody>
        </table>
    </div>

    <!-- SZYBKIE LOTKI -->
    <h2>Podsumowanie szybkich lotek</h2>
    <p id="fast-legs-matches" class="summary"></p>
    <p id="fast-legs-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="fast-legs-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba szybkich lotek</th>
                    <th data-key="values">Szybkie legi (<=18)</th>
                </tr>
            </thead>
            <tbody id="fast-legs-body"></tbody>
        </table>
    </div>
</div>

<script>
// --- SORTOWANIE ---
function makeSortable(tableId, rowsData, buildRow) {
    const headers = document.querySelectorAll(`#${tableId} th.sortable`);
    headers.forEach((th) => {
        let asc = false;
        th.addEventListener('click', () => {
            headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
            const key = th.dataset.key;
            rowsData.sort((a,b)=>{
                let valA=a[key], valB=b[key];
                if(typeof valA==='string') valA=valA.toLowerCase();
                if(typeof valB==='string') valB=valB.toLowerCase();
                if(valA<valB) return asc?-1:1;
                if(valA>valB) return asc?1:-1;
                return 0;
            });
            th.classList.add(asc?'sorted-asc':'sorted-desc');
            asc=!asc;
            buildRow();
        });
    });
}

// --- GLOBALNE DANE ---
const totals = { max: {}, high: {}, fast: {}, matches: new Set() };
const combined = {};

function updateTricksTable() {
    const rows = [];
    const allPlayers = new Set([...Object.keys(totals.max), ...Object.keys(totals.high), ...Object.keys(totals.fast)]);
    allPlayers.forEach(player => {
        const m = (totals.max[player]?.count || 0);
        const h = (totals.high[player]?.count || 0);
        const f = (totals.fast[player]?.count || 0);
        const total = m + h + f;
        const matches = new Set([
            ...(totals.max[player]?.matches || []),
            ...(totals.high[player]?.matches || []),
            ...(totals.fast[player]?.matches || [])
        ]).size;
        rows.push({ player, matches, total, max: m, high: h, fast: f });
    });
    rows.sort((a,b)=>b.total - a.total);

    const tbody = document.getElementById('tricks-body');
    function buildRows() {
        tbody.innerHTML = '';
        rows.forEach((r,i)=>{
            const tr=document.createElement('tr');
            if(i===0)tr.classList.add('first-place');
            else if(i===1)tr.classList.add('second-place');
            else if(i===2)tr.classList.add('third-place');
            tr.innerHTML=`<td>${r.player}</td><td>${r.matches}</td><td>${r.total}</td><td>${r.max}</td><td>${r.high}</td><td>${r.fast}</td>`;
            tbody.appendChild(tr);
        });
    }
    buildRows();
    makeSortable('tricks-table', rows, buildRows);

    const totalAll = rows.reduce((a,b)=>a+b.total,0);
    document.getElementById('all-tricks-summary').textContent = `Suma wszystkich wybryk√≥w: ${totalAll}`;
}

// --- ≈ÅADOWANIE DANYCH ---
Promise.all([
    fetch('tournament_max.json').then(r=>r.json()),
    fetch('tournament_high_finishes.json').then(r=>r.json()),
    fetch('tournament_fast_legs.json').then(r=>r.json())
]).then(([maxData, highData, fastData])=>{
    // Maxy
    maxData.forEach(m=>{
        const players = m.maxes || {};
        for(const [p,list] of Object.entries(players)){
            if(!list || !list.length) continue;
            if(!totals.max[p]) totals.max[p]={count:0,matches:[]};
            totals.max[p].count += list.length;
            totals.max[p].matches.push(m.tmid);
        }
    });
    // High finishes
    highData.forEach(m=>{
        const players = m.high_finishes || {};
        for(const [p,list] of Object.entries(players)){
            if(!list || !list.length) continue;
            if(!totals.high[p]) totals.high[p]={count:0,matches:[]};
            totals.high[p].count += list.length;
            totals.high[p].matches.push(m.tmid);
        }
    });
    // Fast legs
    fastData.forEach(m=>{
        const players = m.fast_legs || {};
        for(const [p,list] of Object.entries(players)){
            if(!list || !list.length) continue;
            if(!totals.fast[p]) totals.fast[p]={count:0,matches:[]};
            totals.fast[p].count += list.length;
            totals.fast[p].matches.push(m.tmid);
        }
    });
    updateTricksTable();
});
</script>
</body>
</html>
