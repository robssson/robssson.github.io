<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 - Statystyki</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { padding: 20px; background-color: #f9f9f9; }
    h1, h2 { text-align: center; margin-bottom: 20px; color: #2c3e50; }
    h5 { text-align: center; margin-bottom: 10px; color: #555; }
    .summary, #global-summary { text-align: center; font-weight: bold; margin-bottom: 10px; color: #34495e; }
    table th, table td { text-align: center; cursor: pointer; }
    .table-container { overflow-x: auto; margin-bottom: 50px; }

    /* Kolory TOP3 */
    tr.first-place > td { background-color: #ffd700 !important; color: #000 !important; }
    tr.second-place > td { background-color: #c0c0c0 !important; color: #000 !important; }
    tr.third-place > td { background-color: #cd7f32 !important; color: #fff !important; }

    tr.first-place:hover > td { background-color: #ffea70 !important; }
    tr.second-place:hover > td { background-color: #e0e0e0 !important; }
    tr.third-place:hover > td { background-color: #d89454 !important; }

    table.table-hover tbody tr:hover:not(.first-place):not(.second-place):not(.third-place) td {
        background-color: #f0f0f0 !important;
    }

    /* Ikony sortowania */
    th.sortable::after {
        content: '‚áÖ';
        font-size: 0.8em;
        margin-left: 5px;
        color: #999;
    }
    th.sorted-asc::after {
        content: '‚¨ÜÔ∏è';
        font-size: 0.8em;
        margin-left: 5px;
        color: #007bff;
    }
    th.sorted-desc::after {
        content: '‚¨áÔ∏è';
        font-size: 0.8em;
        margin-left: 5px;
        color: #007bff;
    }
</style>
</head>
<body>
<div class="container">
    <h5>Ostatnia aktualizacja: 15/10/2025</h5>
    <h1>üéØ Tomi Dart Club Liga Jesie≈Ñ 2025 üéØ</h1>

    <!-- GLOBALNE PODSUMOWANIE -->
    <div id="global-summary" class="mb-4 fs-5">
        üîÑ ≈Åadowanie danych...
    </div>

    <!-- MAKSY -->
    <h2>Podsumowanie maks√≥w (180)</h2>
    <p id="max-matches" class="summary"></p>
    <p id="max-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="max-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba 180</th>
                    <th data-key="values" class="sortable">Szczeg√≥≈Çy</th>
                </tr>
            </thead>
            <tbody id="max-body"></tbody>
        </table>
    </div>

    <!-- WYSOKIE ZAKO≈ÉCZENIA -->
    <h2>Zestawienie wysokich zako≈Ñcze≈Ñ</h2>
    <p id="high-finishes-matches" class="summary"></p>
    <p id="high-finishes-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="high-finishes-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba wysokich zako≈Ñcze≈Ñ</th>
                    <th data-key="values" class="sortable">Warto≈õci zako≈Ñcze≈Ñ (>=100)</th>
                </tr>
            </thead>
            <tbody id="high-finishes-body"></tbody>
        </table>
    </div>

    <!-- SZYBKIE LOTKI -->
    <h2>Podsumowanie szybkich lotek</h2>
    <p id="fast-legs-matches" class="summary"></p>
    <p id="fast-legs-sum" class="summary"></p>
    <div class="table-container">
        <table class="table table-bordered table-hover" id="fast-legs-table">
            <thead class="table-dark">
                <tr>
                    <th data-key="player" class="sortable">Zawodnik</th>
                    <th data-key="count" class="sortable">Liczba szybkich lotek</th>
                    <th data-key="values" class="sortable">Szybkie legi (<=18)</th>
                </tr>
            </thead>
            <tbody id="fast-legs-body"></tbody>
        </table>
    </div>
</div>

<script>
// --- Uniwersalna funkcja do sortowania ---
function makeSortable(tableId, rowsData, buildRow) {
    const table = document.getElementById(tableId);
    const headers = table.querySelectorAll('th.sortable');
    headers.forEach((th) => {
        let asc = true;
        th.addEventListener('click', () => {
            headers.forEach(h => h.classList.remove('sorted-asc', 'sorted-desc'));
            const key = th.dataset.key;
            rowsData.sort((a,b) => {
                let valA = a[key], valB = b[key];
                if(key === 'count') { valA = parseInt(valA); valB = parseInt(valB); }
                if(valA < valB) return asc ? -1 : 1;
                if(valA > valB) return asc ? 1 : -1;
                return 0;
            });
            th.classList.add(asc ? 'sorted-asc' : 'sorted-desc');
            asc = !asc;
            buildRow();
        });
    });
}

// --- GLOBALNE LICZNIKI ---
const totals = { max: 0, high: 0, fast: 0, matches: new Set() };
function updateGlobalSummary() {
    const div = document.getElementById('global-summary');
    div.innerHTML = `
        üìä <b>≈ÅƒÖcznie rozegranych mecz√≥w:</b> ${totals.matches.size} &nbsp;|&nbsp;
        üí• <b>180:</b> ${totals.max} &nbsp;|&nbsp;
        üéØ <b>Wysokie zako≈Ñczenia:</b> ${totals.high} &nbsp;|&nbsp;
        ‚ö° <b>Szybkie lotki:</b> ${totals.fast}
    `;
}

// --- MAKSY (180) ---
fetch('tournament_max.json').then(r => r.json()).then(data => {
    const total={},details={};
    let all=0;
    const uniqueMatches=new Set(data.map(m=>m.tmid));
    uniqueMatches.forEach(id=>totals.matches.add(id));
    document.getElementById('max-matches').textContent=`Liczba rozegranych mecz√≥w: ${uniqueMatches.size}`;
    data.forEach(match=>{
        const mx=match.maxes||{};
        for(const [p,maxList]of Object.entries(mx)){
            if(!maxList||!maxList.length)continue;
            if(!total[p]){total[p]=0;details[p]=[];}
            total[p]+=maxList.length;
            details[p]=details[p].concat(maxList);
            all+=maxList.length;
        }
    });
    totals.max += all;
    document.getElementById('max-sum').textContent=`Suma wszystkich maks√≥w (180): ${all}`;
    updateGlobalSummary();
    const rowsData=Object.keys(total).map(p=>({player:p,count:total[p],values:"180 √ó "+total[p]})).sort((a,b)=>b.count-a.count);
    const tbody=document.getElementById('max-body');
    function buildRows(){
        tbody.innerHTML='';
        rowsData.forEach((r,i)=>{
            const tr=document.createElement('tr');
            if(i===0)tr.classList.add('first-place');
            else if(i===1)tr.classList.add('second-place');
            else if(i===2)tr.classList.add('third-place');
            tr.innerHTML=`<td>${r.player}</td><td>${r.count}</td><td>${r.values}</td>`;
            tbody.appendChild(tr);
        });
    }
    buildRows();
    makeSortable('max-table',rowsData,buildRows);
});

// --- WYSOKIE ZAKO≈ÉCZENIA ---
fetch('tournament_high_finishes.json').then(r => r.json()).then(data => {
    const playerFinishes = {};
    let total = 0;
    const uniqueMatches = new Set(data.map(m => m.tmid));
    uniqueMatches.forEach(id=>totals.matches.add(id));
    document.getElementById('high-finishes-matches').textContent = `Liczba rozegranych mecz√≥w: ${uniqueMatches.size}`;
    data.forEach(match => {
        const hf = match.high_finishes || {};
        for(const [p, f] of Object.entries(hf)) {
            if(!f || !f.length) continue;
            if(!playerFinishes[p]) playerFinishes[p] = [];
            playerFinishes[p] = playerFinishes[p].concat(f);
            total += f.length;
        }
    });
    totals.high += total;
    document.getElementById('high-finishes-sum').textContent = `Suma wszystkich wysokich zako≈Ñcze≈Ñ: ${total}`;
    updateGlobalSummary();
    const rowsData = Object.entries(playerFinishes).map(([p,f])=>({player:p,count:f.length,values:f.sort((a,b)=>a-b).join(', ')})).sort((a,b)=>b.count-a.count);
    const tbody=document.getElementById('high-finishes-body');
    function buildRows(){
        tbody.innerHTML='';
        rowsData.forEach((r,i)=>{
            const tr=document.createElement('tr');
            if(i===0)tr.classList.add('first-place');
            else if(i===1)tr.classList.add('second-place');
            else if(i===2)tr.classList.add('third-place');
            tr.innerHTML=`<td>${r.player}</td><td>${r.count}</td><td>${r.values}</td>`;
            tbody.appendChild(tr);
        });
    }
    buildRows();
    makeSortable('high-finishes-table',rowsData,buildRows);
});

// --- SZYBKIE LOTKI ---
fetch('tournament_fast_legs.json').then(r => r.json()).then(data => {
    const total={},nums={};
    let all=0;
    const uniqueMatches=new Set(data.map(m=>m.tmid));
    uniqueMatches.forEach(id=>totals.matches.add(id));
    document.getElementById('fast-legs-matches').textContent=`Liczba rozegranych mecz√≥w: ${uniqueMatches.size}`;
    data.forEach(match=>{
        const fl=match.fast_legs||{};
        for(const [p,legs]of Object.entries(fl)){
            if(!legs||!legs.length)continue;
            if(!total[p]){total[p]=0;nums[p]=[];}
            total[p]+=legs.length;
            nums[p]=nums[p].concat(legs);
            all+=legs.length;
        }
    });
    totals.fast += all;
    document.getElementById('fast-legs-sum').textContent=`Suma wszystkich szybkich lotek: ${all}`;
    updateGlobalSummary();
    const rowsData=Object.keys(total).map(p=>({player:p,count:total[p],values:nums[p].sort((a,b)=>a-b).join(', ')})).sort((a,b)=>b.count-a.count);
    const tbody=document.getElementById('fast-legs-body');
    function buildRows(){
        tbody.innerHTML='';
        rowsData.forEach((r,i)=>{
            const tr=document.createElement('tr');
            if(i===0)tr.classList.add('first-place');
            else if(i===1)tr.classList.add('second-place');
            else if(i===2)tr.classList.add('third-place');
            tr.innerHTML=`<td>${r.player}</td><td>${r.count}</td><td>${r.values}</td>`;
            tbody.appendChild(tr);
        });
    }
    buildRows();
    makeSortable('fast-legs-table',rowsData,buildRows);
});
</script>
</body>
</html>
